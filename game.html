<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Firebase config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// =========================
// Firebase Config
// =========================
const firebaseConfig = {
  apiKey: "AIzaSyAJZM3DMlhfo5GbGKd-8CTjGYQ6CPL2XxU",
  authDomain: "jingooth-fusion.firebaseapp.com",
  projectId: "jingooth-fusion",
  storageBucket: "jingooth-fusion.firebasestorage.app",
  messagingSenderId: "60755175841",
  appId: "1:60755175841:web:c61eeb6f4752171b4083e0",
  measurementId: "G-X5YQEXSLTB"
};

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// =========================
// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÄ‡∏Å‡∏°
// =========================
async function saveScore(name, score){
  try {
    await db.collection("scores").add({
      name: name || "Guest",
      score: score,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    console.log("‚úÖ Saved to Firestore:", name, score);
  } catch(e) {
    console.error("‚ùå Error saving:", e);
  }
}

// =========================
// ‡πÅ‡∏™‡∏î‡∏á Leaderboard
// =========================
async function showLeaderboard(){
  try {
    const querySnap = await db.collection("scores")
      .orderBy("score","desc")
      .limit(10)
      .get();
    let html = `<div class="leaderboard"><h2>üèÜ Leaderboard (Top 10)</h2><ol>`;
    querySnap.forEach(doc=>{
      const d = doc.data();
      html += `<li>${d.name || "Guest"} ‚Äî ${d.score || 0}</li>`;
    });
    html += `</ol></div>`;
    const panel = document.getElementById("panel");
    const card = panel.querySelector(".card");
    const old = card.querySelector(".leaderboard");
    if(old) old.remove();
    card.insertAdjacentHTML("beforeend", html);
  } catch(e){
    console.warn("‚ö†Ô∏è Cannot load leaderboard:", e);
  }
}

// =========================
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏° (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ó‡∏£‡∏Å‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å)
// =========================
async function endGame(){
  if(gameOver) return;
  gameOver = true; allowDrop = false;
  stopBGM(); playSound('over', false, 0.7);

  const name = localStorage.getItem("playerName") || prompt("Enter your name:") || "Guest";
  localStorage.setItem("playerName", name);
  await saveScore(name, score);
  await showLeaderboard();

  panel.style.display='flex';
  panel.querySelector('h1').innerText='Game Over üí•';
  panel.querySelector('p').innerText='Thanks for smiling with Yeo Jin Goo üå∏';
  btnStart.textContent='üîÑ Play Again';
  btnBack.style.display='inline-block';
}
</script>
