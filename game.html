<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Jingooth Fusion üçâ</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
html,body{
  margin:0;padding:0;width:100%;height:100%;
  background:linear-gradient(180deg,#fde2f3,#d8dcff);
  font-family:'Fredoka One',sans-serif;overflow:hidden;touch-action:none;
}
#gameContainer{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
canvas{
  aspect-ratio:420/720;width:100%;max-width:480px;height:auto;
  background:#eef1ff;border-radius:20px;box-shadow:0 6px 14px rgba(0,0,0,.2);
}
.scorebox{
  position:absolute;top:3%;left:50%;transform:translateX(-50%);
  background:#fff8fb;border:3px solid #ff5b8a;border-radius:18px;padding:6px 16px;
  font-size:26px;color:#ff5b8a;font-weight:900;text-shadow:1px 1px 0 #fff;
  box-shadow:0 3px 8px rgba(0,0,0,0.1);
}
.cute-line{
  position:absolute;top:17%;left:50%;transform:translateX(-50%);
  width:78%;height:6px;border-radius:10px;
  background:repeating-linear-gradient(90deg,#ffd7ef,#ffd7ef 12px,#fff0fa 12px,#fff0fa 24px);
  box-shadow:0 2px 6px rgba(255,200,230,.4);
}
#preview{
  position:absolute;top:11%;left:50%;transform:translateX(-50%);
  width:70px;height:70px;pointer-events:none;
}
.panel{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,0.45);z-index:10;text-align:center;
}
.card{
  background:#fff;border-radius:20px;padding:24px;width:85%;max-width:380px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}
.card h1{font-size:22px;margin-bottom:8px;color:#ff5b8a;}
.card p{font-size:14px;color:#555;margin-bottom:12px;}
.btn{
  border:none;border-radius:12px;padding:12px 18px;margin:6px;
  font-weight:700;font-size:16px;color:#fff;cursor:pointer;
}
.btn.primary{background:#8aa7ff;}
.btn.secondary{background:linear-gradient(145deg,#ffa8d8,#ffbde5);border:2px solid #ff87ca;}
footer{position:fixed;bottom:8px;right:10px;color:#7a9cff;font-size:13px;font-weight:600;}
.pulse{animation:scorePulse .3s ease-in-out;}
@keyframes scorePulse{0%{transform:scale(1);}50%{transform:scale(1.25);}100%{transform:scale(1);}}
</style>
<script defer src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
</head>
<body>
<div id="gameContainer">
  <canvas id="game" width="420" height="720"></canvas>
  <div class="cute-line"></div>
  <img id="preview" src="">
  <div class="scorebox">‚≠ê <span id="score">0</span></div>
</div>

<div id="panel" class="panel">
  <div class="card">
    <h1>Smile with Yeo Jin-goo üíï</h1>
    <p>Tap to drop and merge the smiling faces!</p>
    <button class="btn primary" id="btnStart">Start Game</button>
    <button class="btn secondary" id="btnBack" style="display:none;" onclick="window.location.href='index.html'">üè† Back to Main</button>
  </div>
</div>

<footer>by: namaoi.sweet üíï</footer>

<audio id="soundDrop" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2f5a0e7b8f.mp3?filename=pop-94319.mp3" preload="auto"></audio>
<audio id="soundMerge" src="https://cdn.pixabay.com/download/audio/2021/09/06/audio_00e08ad807.mp3?filename=soft-bling-1046.mp3" preload="auto"></audio>
<audio id="soundOver" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_34563f6ef3.mp3?filename=cute-little-failure-94669.mp3" preload="auto"></audio>
<audio id="bgm" src="https://cdn.pixabay.com/download/audio/2022/03/09/audio_bf188c76da.mp3?filename=happy-day-11157.mp3" loop preload="auto"></audio>

<script>
const IMG_COUNT=12;
const IMG_PATHS=Array.from({length:IMG_COUNT},(_,i)=>`images/face${i+1}.png`);
let Engine,Render,World,Bodies,Events,engine,world,textures=[];
let allowDrop=false,dropX=210,score=0,nextLevel=1,gameOver=false,lastDrop=0;
const SAFE_LINE_Y=140,BUFFER=30;
const canvas=document.getElementById('game'),
scoreEl=document.getElementById('score'),
preview=document.getElementById('preview'),
panel=document.getElementById('panel'),
btnStart=document.getElementById('btnStart'),
btnBack=document.getElementById('btnBack');
const sDrop=document.getElementById('soundDrop'),
sMerge=document.getElementById('soundMerge'),
sOver=document.getElementById('soundOver'),
bgm=document.getElementById('bgm');
let audioUnlocked=false;

function unlockAudio(){
  if(audioUnlocked)return;
  [sDrop,sMerge,sOver,bgm].forEach(a=>{
    const playPromise=a.play();
    if(playPromise!==undefined){
      playPromise.then(()=>{a.pause();a.currentTime=0;});
    }
  });
  audioUnlocked=true;
}

async function loadImages(){
  return Promise.all(IMG_PATHS.map(src=>new Promise((res,rej)=>{
    const img=new Image();img.onload=()=>res(img);img.onerror=rej;img.src=src;
  })));
}

function setupMatter(){
  Engine=Matter.Engine;Render=Matter.Render;World=Matter.World;Bodies=Matter.Bodies;Events=Matter.Events;
  engine=Engine.create();
  const render=Render.create({canvas,engine,options:{width:420,height:720,wireframes:false,background:'transparent'}});
  world=engine.world;
  World.add(world,[
    Bodies.rectangle(210,740,420,40,{isStatic:true}),
    Bodies.rectangle(-20,360,40,720,{isStatic:true}),
    Bodies.rectangle(440,360,40,720,{isStatic:true})
  ]);
  Matter.Runner.run(Matter.Runner.create(),engine);
  Render.run(render);
  Events.on(engine,'collisionStart',e=>{
    for(const p of e.pairs){
      const a=p.bodyA,b=p.bodyB;
      if(a.custom&&b.custom&&a.custom.level===b.custom.level&&!a.merged&&!b.merged){
        a.merged=b.merged=true;setTimeout(()=>merge(a,b),120);
      }
    }
  });
}

function addPiece(level,x=210){
  const r=18+level*6,tex=textures[level-1];
  const body=Bodies.circle(x,100,r,{restitution:0.15,friction:0.001,
    render:{sprite:{texture:tex.src,xScale:(r*2)/tex.width,yScale:(r*2)/tex.height}}});
  body.custom={level};
  World.add(world,body);
  try{sDrop.currentTime=0;sDrop.play();}catch{}
  return body;
}

function merge(a,b){
  const lvl=a.custom.level;
  const nx=(a.position.x+b.position.x)/2,ny=(a.position.y+b.position.y)/2;
  World.remove(world,a);World.remove(world,b);
  if(lvl<IMG_COUNT){
    const c=addPiece(lvl+1,nx);
    Matter.Body.setPosition(c,{x:nx,y:ny});
    score+=lvl*10;sMerge.currentTime=0;sMerge.play();
  }else score+=lvl*25;
  scoreEl.textContent=score;
  scoreEl.classList.add("pulse");
  setTimeout(()=>scoreEl.classList.remove("pulse"),300);
  checkGameOver();
}

function scheduleNextLevel(){
  const r=Math.random();nextLevel=r<.6?1:r<.85?2:r<.95?3:4;
  preview.src=textures[nextLevel-1].src;
}

function dropPiece(){
  const now=Date.now();
  if(!allowDrop||gameOver||now-lastDrop<400)return;
  lastDrop=now;
  addPiece(nextLevel,Math.max(30,Math.min(390,dropX)));
  scheduleNextLevel();
}

function checkGameOver(){
  const all=Matter.Composite.allBodies(engine.world).filter(b=>b.custom);
  if(all.length<15)return; // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏û‡∏≠
  const topPieces=all.filter(b=>b.position.y<200);
  if(topPieces.length>4){endGame();}
}

function initControls(){
  const move=e=>{
    const rect=canvas.getBoundingClientRect();
    const clientX=e.touches?e.touches[0].clientX:e.clientX;
    const x=(clientX-rect.left)*(420/rect.width);
    dropX=Math.max(30,Math.min(390,x));
    preview.style.left=`${clientX}px`;
  };
  canvas.addEventListener('mousemove',move);
  canvas.addEventListener('touchmove',move,{passive:true});
  canvas.addEventListener('click',()=>dropPiece());
  canvas.addEventListener('touchend',()=>dropPiece(),{passive:true});
}

function endGame(){
  if(gameOver)return;
  gameOver=true;allowDrop=false;
  try{sOver.currentTime=0;sOver.play();bgm.pause();}catch{}
  panel.style.display='flex';
  panel.querySelector('h1').innerText='Game Over üí•';
  panel.querySelector('p').innerText='Thanks for smiling with Yeo Jin Goo üå∏';
  btnStart.textContent='üîÑ Play Again';
  btnBack.style.display='inline-block';
}

async function boot(){
  textures=await loadImages();
  setupMatter();initControls();scheduleNextLevel();allowDrop=true;
}

btnStart.addEventListener('click',()=>{
  unlockAudio();
  panel.style.display='none';
  bgm.volume=0.25;bgm.currentTime=0;bgm.play();
  if(engine){
    const bodies=Matter.Composite.allBodies(engine.world);
    for(const b of bodies){if(!b.isStatic)World.remove(world,b);}
    score=0;scoreEl.textContent='0';gameOver=false;
    scheduleNextLevel();allowDrop=true;btnBack.style.display='none';
    return;
  }
  boot();
});
</script>
</body>
</html>
